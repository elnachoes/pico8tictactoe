pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--!# tictactoe.p8

--this is the gamestate 
gamestate = {}

function _init()
	-- enable mouse and keyboard input by poking this register
	poke(0x5f2d, 0x1)
	reset_game()
end

function _update()
	handle_mouse_input()
	if not gamestate.gameover then
		check_if_gameover()
	end
end

function _draw()
	-- clear the screen
	 cls()
	
	-- draw the player name or gameover
	if not gamestate.gameover then
		print("player "..gamestate.playerturn.." turn")
	else
		print("gameover")
		print("mouse click left to reset")
	end

	-- draw the gameboard
	draw_board()
	
	-- draw the mouse cursor
	spr(3, stat(32), stat(33))
end

function draw_board()
	-- draw the board
	for i = 1,3 do
		for j = 1,3 do
			spr(gamestate.board[i][j],16 + (j * 8), 16 + (i * 8))
		end
	end
end

function handle_mouse_input() 
	-- handle mouse input and place a marker on the nearest square

	if stat(34) == 1 then
		if not gamestate.gameover then
			if stat(32) > 16 and stat(32) <= 48 and stat(33) > 16 and stat(33) <= 48 then
	
				-- place a marker on the board
				if gamestate.playerturn == 1 then
					gamestate.board[((stat(33)-16) \ 8)][((stat(32)-16) \ 8)] = 1
				else
					gamestate.board[((stat(33)-16) \ 8)][((stat(32)-16) \ 8)] = 2
				end
	
				-- switch turn
				if gamestate.playerturn == 1 then
					gamestate.playerturn = 2
				else 
					gamestate.playerturn = 1
				end
	
				-- infinitely loop until the player stops holding the left mouse button down
				while stat(34) == 1  do end
			end
		else 
			reset_game()
		end
	end
end

function check_if_gameover()
	board = gamestate.board
	
	-- check for verticals and horizontals
	for i = 1,3 do
		if board[1][i] == board[2][i] and board[1][i] == board[3][i] and board[3][i] != 0 or 
			board[i][1] == board[i][2] and board[i][1] == board[i][3] and board[i][3] != 0 then
			gamestate.gameover = true
		end
	end

	-- check for diagonals
	if board[1][1] == board[2][2] and board[1][1] == board[3][3] and board[3][3] != 0 or 
		board[1][3] == board[2][2] and board[3][1] == board[1][3] and board[1][3] != 0 then
		gamestate.gameover = true
	end

	-- check for a tie the game should be over if no spaces are zero
	if not gamestate.gameover then
		gamestate.gameover = true
		for i = 1,3 do
			for j = 1,3 do
				if gamestate.board[i][j] == 0 then
					gamestate.gameover = false
				end
			end
		end
	end
end

function reset_game()
	gamestate = {
		board = {
			{0,0,0},
			{0,0,0},
			{0,0,0},
		}, 
		playerturn = 1,
		gameover = false,
	}
end
__gfx__
88888888888888888888888801000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80000008870000788000000817100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80000008807007088077770817710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80000008800770088070070817771000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80000008800770088070070817777100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80000008807007088077770817711000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80000008870000788000000801171000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888888888888888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0100000000000000000000000000000101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0100000000000000000000000000000101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0100000000000000000000000000000101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0100000000000000000000000000000101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0100000000000000000000000000000101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0100000000000000000000000000000101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0100000000000000000000000000000101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
__sfx__
0002000006050090501b25019250182501825018250182501725017250162501625015250152501325012250112500e2500c2500a25008250072500625005250052500525031050310502e05028050230501e050
